<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç VK –†–µ–∫–ª–∞–º–Ω–æ–π –°—Å—ã–ª–∫–∏</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
        }
        h1 {
            margin-top: 0;
            color: #667eea;
        }
        .test-section {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-link {
            background: #fff;
            border: 2px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            word-break: break-all;
            font-family: monospace;
            font-size: 14px;
            color: #667eea;
            margin: 10px 0;
        }
        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .param-table th, .param-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .param-table th {
            background: #667eea;
            color: white;
        }
        .param-table tr:hover {
            background: #f5f5f5;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-ok {
            background: #4caf50;
            color: white;
        }
        .status-missing {
            background: #ff9800;
            color: white;
        }
        .status-error {
            background: #f44336;
            color: white;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VK –†–µ–∫–ª–∞–º–Ω–æ–π –°—Å—ã–ª–∫–∏</h1>
        
        <div class="test-section">
            <h2>üìã –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∏–∑ VK —Ä–µ–∫–ª–∞–º—ã:</h2>
            <div class="test-link" id="originalLink">
                https://vk.com/app53875526#utm_source=vk_mini_app&ref={ref}&ref_source={banner_id}&utm_term={user_id}
            </div>
            
            <p><strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> VK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω–∏—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:</p>
            <ul>
                <li><code>{ref}</code> ‚Üí —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏</li>
                <li><code>{banner_id}</code> ‚Üí ID –±–∞–Ω–Ω–µ—Ä–∞</li>
                <li><code>{user_id}</code> ‚Üí ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VK</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:</h2>
            
            <label>
                <strong>ref (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏):</strong>
                <input type="text" id="refInput" value="vk_ads_test_2025" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
            </label>
            
            <label>
                <strong>banner_id (ID –±–∞–Ω–Ω–µ—Ä–∞):</strong>
                <input type="text" id="bannerInput" value="banner_001" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
            </label>
            
            <label>
                <strong>user_id (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VK):</strong>
                <input type="text" id="userInput" value="123456789" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
            </label>
            
            <button class="button" onclick="generateTestLink()">üîó –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Å—ã–ª–∫—É</button>
            <button class="button" onclick="testLinkInApp()">üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</button>
            <button class="button" onclick="sendToLeadsTech()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Leads.Tech</button>
        </div>

        <div id="generatedLink" style="display: none;" class="test-section">
            <h3>‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞:</h3>
            <div class="test-link" id="testLinkDisplay"></div>
            <button class="button" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="button" onclick="openTestLink()">üöÄ –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</button>
        </div>

        <div id="extractionResults" style="display: none;" class="test-section">
            <h3>üîç –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</h3>
            <table class="param-table">
                <thead>
                    <tr>
                        <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                        <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody id="paramsTable"></tbody>
            </table>
        </div>

        <div id="leadsTechTest" style="display: none;" class="test-section">
            <h3>üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Leads.Tech:</h3>
            <div id="leadsTechResult"></div>
        </div>

        <div class="test-section">
            <h2>üìñ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à–∞ —Å—Å—ã–ª–∫–∞:</h2>
            
            <h3>1. VK –∑–∞–º–µ–Ω—è–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</h3>
            <pre>–ë—ã–ª–æ: https://vk.com/app53875526#ref={ref}
–°—Ç–∞–ª–æ: https://vk.com/app53875526#ref=vk_ads_test_2025</pre>

            <h3>2. –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
            <pre>// useUTMTracker.js –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ hash (#)
const hashParams = new URLSearchParams(window.location.hash.substring(1));
utm_source: "vk_mini_app"
ref: "vk_ads_test_2025"
ref_source: "banner_001"
utm_term: "123456789"</pre>

            <h3>3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ Leads.Tech</h3>
            <pre>// useArbitrageTracker.js
s4: ref (vk_ads_test_2025)
s5: ref_source (banner_001)
s6: user_id (123456789)

–ò—Ç–æ–≥–æ–≤–∞—è —Å—Å—ã–ª–∫–∞ –ú–§–û:
https://t.leads.tech/click/888/1/?sub1=...&sub4=vk_ads_test_2025&sub5=banner_001&sub6=123456789</pre>
        </div>

        <div class="test-section">
            <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç:</h2>
            <ul>
                <li>‚úÖ –°—Å—ã–ª–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <code>#</code> (hash) - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è VK</li>
                <li>‚úÖ <code>utm_source=vk_mini_app</code> - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä</li>
                <li>‚úÖ <code>ref={ref}</code> - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, VK –∑–∞–º–µ–Ω–∏—Ç</li>
                <li>‚úÖ <code>ref_source={banner_id}</code> - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, VK –∑–∞–º–µ–Ω–∏—Ç</li>
                <li>‚úÖ <code>utm_term={user_id}</code> - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, VK –∑–∞–º–µ–Ω–∏—Ç</li>
                <li>‚úÖ –í–∞—à –∫–æ–¥ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ hash</li>
                <li>‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ leads.tech</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è VK —Ä–µ–∫–ª–∞–º—ã:</h2>
            
            <h3>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É:</h3>
            <div class="test-link">
                https://vk.com/app53875526#utm_source=vk_mini_app&ref={ref}&ref_source={banner_id}&utm_term={user_id}
            </div>
            
            <h3>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ VK —Ä–µ–∫–ª–∞–º–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ:</h3>
            <ul>
                <li><strong>{ref}</strong> - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: spring_2025, promo_winter)</li>
                <li><strong>{banner_id}</strong> - ID –±–∞–Ω–Ω–µ—Ä–∞ –∏–ª–∏ –≥—Ä—É–ø–ø—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π</li>
                <li><strong>{user_id}</strong> - VK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
            </ul>
        </div>
    </div>

    <script>
        function generateTestLink() {
            const ref = document.getElementById('refInput').value;
            const banner = document.getElementById('bannerInput').value;
            const userId = document.getElementById('userInput').value;
            
            const testLink = `https://vk.com/app53875526#utm_source=vk_mini_app&ref=${ref}&ref_source=${banner}&utm_term=${userId}`;
            
            document.getElementById('testLinkDisplay').textContent = testLink;
            document.getElementById('generatedLink').style.display = 'block';
            
            window.testLink = testLink;
        }

        function copyToClipboard() {
            const link = document.getElementById('testLinkDisplay').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function openTestLink() {
            window.open(window.testLink, '_blank');
        }

        function testLinkInApp() {
            const ref = document.getElementById('refInput').value;
            const banner = document.getElementById('bannerInput').value;
            const userId = document.getElementById('userInput').value;
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–∫ –≤ useUTMTracker
            const testUrl = `https://vk.com/app53875526#utm_source=vk_mini_app&ref=${ref}&ref_source=${banner}&utm_term=${userId}`;
            const hash = testUrl.split('#')[1];
            const params = new URLSearchParams(hash);
            
            const extractedParams = {
                'utm_source': params.get('utm_source'),
                'ref': params.get('ref'),
                'ref_source': params.get('ref_source'),
                'utm_term': params.get('utm_term'),
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–≤–ª–µ–∫–ª–∏—Å—å
            let html = '<table class="param-table"><thead><tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
            
            Object.entries(extractedParams).forEach(([key, value]) => {
                const status = value ? 
                    '<span class="status status-ok">‚úÖ OK</span>' : 
                    '<span class="status status-missing">‚ö†Ô∏è –ü—É—Å—Ç–æ</span>';
                html += `<tr><td><code>${key}</code></td><td><strong>${value || '–Ω/–¥'}</strong></td><td>${status}</td></tr>`;
            });
            
            html += '</tbody></table>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è leads.tech
            html += '<h4>üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Leads.Tech:</h4>';
            html += '<table class="param-table"><thead><tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä Leads.Tech</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–û—Ç–∫—É–¥–∞</th></tr></thead><tbody>';
            
            const leadsTechParams = {
                's4': { value: extractedParams.ref, source: 'ref' },
                's5': { value: extractedParams.ref_source, source: 'ref_source' },
                's6': { value: extractedParams.utm_term || userId, source: 'utm_term / user_id' },
            };
            
            Object.entries(leadsTechParams).forEach(([key, data]) => {
                const status = data.value ? 
                    '<span class="status status-ok">‚úÖ OK</span>' : 
                    '<span class="status status-error">‚ùå –ù–µ—Ç</span>';
                html += `<tr><td><code>${key}</code></td><td><strong>${data.value || '–Ω/–¥'}</strong></td><td>${data.source} ${status}</td></tr>`;
            });
            
            html += '</tbody></table>';
            
            // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –ú–§–û
            const mfoLink = `https://t.leads.tech/click/888/1/?sub1=babkimankirf-of-list-moneyman&sub2=vk_mini_app&sub4=${extractedParams.ref || ''}&sub5=${extractedParams.ref_source || ''}&sub6=${extractedParams.utm_term || userId}`;
            
            html += '<h4>üîó –ò—Ç–æ–≥–æ–≤–∞—è —Å—Å—ã–ª–∫–∞ –ú–§–û (–ø—Ä–∏–º–µ—Ä MoneyMan):</h4>';
            html += `<div class="test-link" style="color: #4caf50;">${mfoLink}</div>`;
            
            document.getElementById('paramsTable').innerHTML = html;
            document.getElementById('extractionResults').style.display = 'block';
        }

        async function sendToLeadsTech() {
            const ref = document.getElementById('refInput').value;
            const banner = document.getElementById('bannerInput').value;
            const userId = document.getElementById('userInput').value;
            
            const testData = {
                user_id: userId,
                first_name: "–¢–µ—Å—Ç",
                last_name: "–¢–µ—Å—Ç–æ–≤—ã–π",
                utm_source: "vk_mini_app",
                ref: ref,
                ref_source: banner,
                utm_term: userId,
                vk_user_id: userId,
                url: window.location.href,
                timestamp: new Date().toISOString()
            };
            
            try {
                const response = await fetch('https://bodyexp.ru/api/arbitrage/send-to-leads-tech/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                let html = '<div class="result">';
                if (result.success) {
                    html += '<h4>‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Leads.Tech!</h4>';
                    html += `<p><strong>Tracking ID:</strong> ${result.tracking_id}</p>`;
                    html += `<p><strong>Timestamp:</strong> ${result.timestamp}</p>`;
                    
                    if (result.leads_tech_url) {
                        html += '<h4>üîó URL –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤ Leads.Tech:</h4>';
                        html += `<div class="test-link" style="color: #4caf50;">${result.leads_tech_url}</div>`;
                    }
                    
                    if (result.leads_tech_params) {
                        html += '<h4>üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Leads.Tech:</h4>';
                        html += '<pre>' + JSON.stringify(result.leads_tech_params, null, 2) + '</pre>';
                    }
                } else {
                    html += `<h4>‚ùå –û—à–∏–±–∫–∞: ${result.error}</h4>`;
                }
                html += '</div>';
                
                document.getElementById('leadsTechResult').innerHTML = html;
                document.getElementById('leadsTechTest').style.display = 'block';
                
            } catch (error) {
                document.getElementById('leadsTechResult').innerHTML = 
                    `<div class="result error"><h4>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:</h4><p>${error.message}</p></div>`;
                document.getElementById('leadsTechTest').style.display = 'block';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL, –µ—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        window.addEventListener('DOMContentLoaded', () => {
            const currentHash = window.location.hash;
            if (currentHash && currentHash.includes('ref=')) {
                const params = new URLSearchParams(currentHash.substring(1));
                const ref = params.get('ref');
                const refSource = params.get('ref_source');
                const utmTerm = params.get('utm_term');
                
                if (ref) document.getElementById('refInput').value = ref;
                if (refSource) document.getElementById('bannerInput').value = refSource;
                if (utmTerm) document.getElementById('userInput').value = utmTerm;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
                setTimeout(() => {
                    generateTestLink();
                    testLinkInApp();
                }, 500);
            }
        });
    </script>
</body>
</html>

